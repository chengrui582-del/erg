<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åŸå¸‚é¢¨ç¤¾äº¤ç¶²ç«™</title>
<style>
body {
  font-family: 'Arial', sans-serif;
  margin:0;
  background: url('https://images.unsplash.com/photo-1501594907352-04cda38ebc29?auto=format&fit=crop&w=1950&q=80') no-repeat center center fixed;
  background-size: cover;
  color:#333;
}
header {
  background: rgba(0,0,0,0.7);
  color:white; padding:10px 20px;
  display:flex; justify-content:space-between; align-items:center;
  position:sticky; top:0;
  z-index:10;
}
header a {
  color:white; text-decoration:none; margin-left:15px; cursor:pointer; font-weight:bold;
}
.container {
  max-width:1000px; margin:20px auto; display:flex; gap:20px;
}
.feed { flex:2; display:flex; flex-direction:column; gap:15px; }
.sidebar { flex:1; background:rgba(255,255,255,0.9); padding:15px; border-radius:10px; height:fit-content; }
.post, .friend { background:rgba(255,255,255,0.95); padding:15px; border-radius:10px; margin-bottom:10px; }
.post-header { display:flex; align-items:center; gap:10px; }
.post-header img { width:40px; height:40px; border-radius:50%; }
.post-content { margin:10px 0; }
.post-actions { display:flex; gap:10px; }
.post-actions button { cursor:pointer; padding:5px 10px; border:none; border-radius:5px; background:#e4e6eb; }
input[type=text], input[type=password] { width:100%; padding:8px; border-radius:5px; border:1px solid #ccc; margin-bottom:5px; }
button.send { width:100%; background:#4267B2; color:white; padding:8px; border:none; border-radius:5px; cursor:pointer; }
#authContainer { max-width:400px; margin:50px auto; background:rgba(255,255,255,0.95); padding:20px; border-radius:10px; }
</style>
</head>
<body>

<header style="display:none;" id="mainHeader">
  <h1>åŸå¸‚é¢¨ç¤¾äº¤ç¶²ç«™</h1>
  <nav>
    <a onclick="showSection('feed')">é¦–é </a>
    <a onclick="showSection('profile')">å€‹äººé </a>
    <a onclick="showSection('friends')">å¥½å‹åˆ—è¡¨</a>
    <a onclick="logout()">ç™»å‡º</a>
  </nav>
</header>

<!-- è¨»å†Š / ç™»å…¥ -->
<div id="authContainer">
  <h2>è¨»å†Š / ç™»å…¥</h2>
  <input type="text" id="username" placeholder="ä½¿ç”¨è€…åç¨±"><br>
  <input type="password" id="password" placeholder="å¯†ç¢¼"><br>
  <button onclick="register()">è¨»å†Š</button>
  <button onclick="login()">ç™»å…¥</button>
  <p id="authMsg" style="color:red;"></p>
</div>

<!-- é¦–é å‹•æ…‹ç‰† -->
<div class="container" id="feedContainer" style="display:none;">
  <div class="feed" id="feed">
    <div style="background:rgba(255,255,255,0.9); padding:10px; border-radius:10px;">
      <input type="text" id="newPost" placeholder="ä½ åœ¨æƒ³ä»€éº¼ï¼Ÿ">
      <button class="send" onclick="addPost()">ç™¼ä½ˆ</button>
    </div>
  </div>
  <div class="sidebar">
    <h3>å¥½å‹åˆ—è¡¨</h3>
    <div id="friendList"></div>
  </div>
</div>

<!-- å€‹äººé  -->
<div class="container" id="profileContainer" style="display:none;">
  <div class="feed">
    <div style="background:rgba(255,255,255,0.9); padding:10px; border-radius:10px; margin-bottom:10px;">
      <h3>ç·¨è¼¯æš±ç¨±</h3>
      <input type="text" id="nicknameInput" placeholder="æš±ç¨±">
      <button class="send" onclick="updateProfile()">å„²å­˜ä¿®æ”¹</button>
    </div>
    <h3>æˆ‘çš„è²¼æ–‡</h3>
    <div id="myPosts"></div>
  </div>
</div>

<script>
// ======== åˆå§‹åŒ–è³‡æ–™ ========
let currentUser = null;
if(!localStorage.users) localStorage.users = JSON.stringify([]);
if(!localStorage.posts) localStorage.posts = JSON.stringify([]);
if(!localStorage.friendships) localStorage.friendships = JSON.stringify({});

// ======== é é¢åˆ‡æ› ========
function showSection(section){
  document.getElementById('authContainer').style.display='none';
  document.getElementById('feedContainer').style.display = section==='feed'?'flex':'none';
  document.getElementById('profileContainer').style.display = section==='profile'?'flex':'none';
  document.getElementById('friendsContainer')?.style.display = section==='friends'?'flex':'none';
  if(section==='feed') loadPosts();
  if(section==='profile') loadMyPosts();
  if(section==='friends') loadFriends();
}

// ======== è¨»å†Š / ç™»å…¥ ========
function register(){
  const username=document.getElementById('username').value;
  const password=document.getElementById('password').value;
  let users=JSON.parse(localStorage.users);
  if(users.find(u=>u.username===username)){ document.getElementById('authMsg').textContent='å¸³è™Ÿå·²å­˜åœ¨'; return; }
  users.push({username,password,nickname:username});
  localStorage.users=JSON.stringify(users);
  document.getElementById('authMsg').textContent='è¨»å†ŠæˆåŠŸ';
}
function login(){
  const username=document.getElementById('username').value;
  const password=document.getElementById('password').value;
  let users=JSON.parse(localStorage.users);
  const user=users.find(u=>u.username===username && u.password===password);
  if(user){ currentUser=user; showSection('feed'); document.getElementById('nicknameInput').value=user.nickname; document.getElementById('mainHeader').style.display='flex'; loadFriends(); }
  else document.getElementById('authMsg').textContent='å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤';
}
function logout(){ currentUser=null; showSection('authContainer'); document.getElementById('mainHeader').style.display='none'; }

// ======== è²¼æ–‡ / ç•™è¨€ / æŒ‰è®š ========
function addPost(){
  const content=document.getElementById('newPost').value;
  if(!content) return;
  let posts=JSON.parse(localStorage.posts);
  posts.unshift({user:currentUser.username, content, likes:[], comments:[]});
  localStorage.posts=JSON.stringify(posts);
  document.getElementById('newPost').value='';
  loadPosts(); loadMyPosts();
}
function loadPosts(){
  const posts=JSON.parse(localStorage.posts);
  const feed=document.getElementById('feed');
  feed.innerHTML=`<div style="background:rgba(255,255,255,0.9); padding:10px; border-radius:10px;">
    <input type="text" id="newPost" placeholder="ä½ åœ¨æƒ³ä»€éº¼ï¼Ÿ">
    <button class="send" onclick="addPost()">ç™¼ä½ˆ</button>
  </div>`;
  posts.forEach((p,i)=>{
    const div=document.createElement('div'); div.className='post';
    let commentsHtml=''; p.comments.forEach(c=>{ commentsHtml+=`<p><strong>${c.user}:</strong> ${c.comment}</p>`; });
    div.innerHTML=`<div class="post-header"><strong>${p.user}</strong></div>
      <div class="post-content">${p.content}</div>
      <div class="post-actions">
        <button onclick="likePost(${i})">ğŸ‘ ${p.likes.length}</button>
        <button onclick="commentPost(${i})">ğŸ’¬ ${p.comments.length}</button>
      </div>
      <div class="comments">${commentsHtml}</div>`;
    feed.appendChild(div);
  });
}
function commentPost(i){
  const comment=prompt("è¼¸å…¥ç•™è¨€ï¼š");
  if(!comment) return;
  let posts=JSON.parse(localStorage.posts);
  posts[i].comments.push({user:currentUser.username, comment});
  localStorage.posts=JSON.stringify(posts);
  loadPosts(); loadMyPosts();
}
function likePost(i){
  let posts=JSON.parse(localStorage.posts);
  if(!posts[i].likes.includes(currentUser.username)) posts[i].likes.push(currentUser.username);
  localStorage.posts=JSON.stringify(posts);
  loadPosts(); loadMyPosts();
}

// ======== å€‹äººé  ========
function loadMyPosts(){
  const posts=JSON.parse(localStorage.posts).filter(p=>p.user===currentUser.username);
  const div=document.getElementById('myPosts'); div.innerHTML='';
  posts.forEach(p=>{
    let d=document.createElement('div'); d.className='post'; d.innerHTML=p.content;
    div.appendChild(d);
  });
}
function updateProfile(){
  let users=JSON.parse(localStorage.users);
  let u=users.find(u=>u.username===currentUser.username);
  u.nickname=document.getElementById('nicknameInput').value;
  localStorage.users=JSON.stringify(users);
  currentUser.nickname=u.nickname;
  alert("æš±ç¨±å·²æ›´æ–°ï¼");
}

// ======== å¥½å‹è¿½è¹¤ ========
function addFriend(friendUsername){
  if(friendUsername===currentUser.username) return alert("ä¸èƒ½åŠ è‡ªå·±å¥½å‹");
  let friendships=JSON.parse(localStorage.friendships);
  if(!friendships[currentUser.username]) friendships[currentUser.username]=[];
  if(!friendships[currentUser.username].includes(friendUsername)){
    friendships[currentUser.username].push(friendUsername);
  }
  localStorage.friendships=JSON.stringify(friendships);
  loadFriends();
}
function getMyFriends(){
  let friendships=JSON.parse(localStorage.friendships);
  return friendships[currentUser.username] || [];
}
function loadFriends(){
  const list=document.getElementById('friendList');
  list.innerHTML='';
  let users=JSON.parse(localStorage.users);
  users.forEach(u=>{
    if(u.username===currentUser.username) return;
    let d=document.createElement('div'); d.className='friend';
    d.innerHTML=`${u.nickname||u.username} <button onclick="addFriend('${u.username}')">åŠ å¥½å‹</button>`;
    list.appendChild(d);
  });
  let myFriends=getMyFriends();
  if(myFriends.length>0){
    let h=document.createElement('h4'); h.textContent="å·²åŠ å¥½å‹ï¼š"; list.appendChild(h);
    myFriends.forEach(f=>{
      let d=document.createElement('div'); d.textContent=f; list.appendChild(d);
    });
  }
}
</script>
</body>
</html>
