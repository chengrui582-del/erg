<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>City Social</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box}
body{
  margin:0;font-family:-apple-system,BlinkMacSystemFont;
  background:
    linear-gradient(rgba(0,0,0,.55),rgba(0,0,0,.9)),
    url("https://images.unsplash.com/photo-1499346030926-9a72daac6c63") center/cover fixed;
  color:#fff;
}
header{
  position:sticky;top:0;z-index:9;
  background:#000c;
  padding:12px 16px;
  display:flex;justify-content:space-between;
}
button{
  border:none;border-radius:20px;
  padding:6px 12px;
  background:#1f6feb;color:#fff;
  cursor:pointer;
}
input,textarea{
  width:100%;background:#000;
  border:1px solid #333;
  border-radius:10px;
  color:#fff;padding:10px;
}
main{max-width:520px;margin:auto;padding:12px}
.card{
  background:#111c;
  border-radius:18px;
  padding:14px;
  margin-bottom:16px;
}
.hidden{display:none}
.post img{width:100%;border-radius:14px;margin-top:10px}
.actions{
  display:flex;gap:16px;font-size:20px;margin-top:8px
}
.comment{font-size:14px;margin-top:6px;opacity:.9}
.comment-box{display:flex;gap:6px;margin-top:6px}
.comment-box input{flex:1}
.userbar{
  display:flex;justify-content:space-between;
  align-items:center;
}
.friend{
  font-size:13px;
  padding:4px 10px;
  border-radius:20px;
  background:#333;
  cursor:pointer;
}
.friend.add{background:#1f6feb}
.friend.ok{background:#444}
</style>
</head>

<body>

<header>
  <b>ğŸŒƒ City Social</b>
  <button id="logout" class="hidden">ç™»å‡º</button>
</header>

<main>

<div class="card" id="auth">
  <h3>ç™»å…¥ / è¨»å†Š</h3>
  <input id="user" placeholder="å¸³è™Ÿ">
  <input id="pass" type="password" placeholder="å¯†ç¢¼">
  <button onclick="login()">é–‹å§‹</button>
</div>

<div class="card hidden" id="postBox">
  <textarea id="text" placeholder="åˆ†äº«åŸå¸‚ç”Ÿæ´»..."></textarea>
  <input type="file" id="img">
  <button onclick="publish()">ç™¼å¸ƒ</button>
</div>

<div id="feed"></div>

</main>

<script>
let current=null
const users=JSON.parse(localStorage.users||"{}")
const posts=JSON.parse(localStorage.posts||"[]")

function save(){
  localStorage.users=JSON.stringify(users)
  localStorage.posts=JSON.stringify(posts)
}

function login(){
  if(!user.value||!pass.value)return alert("è«‹è¼¸å…¥")
  if(!users[user.value])users[user.value]={pass:pass.value,friends:[]}
  if(users[user.value].pass!==pass.value)return alert("å¯†ç¢¼éŒ¯")
  current=user.value
  auth.classList.add("hidden")
  postBox.classList.remove("hidden")
  logout.classList.remove("hidden")
  render()
}
logout.onclick=()=>location.reload()

function publish(){
  if(!text.value)return
  const post={u:current,t:text.value,img:"",likes:[],comments:[]}
  const f=img.files[0]
  if(f){
    const r=new FileReader()
    r.onload=e=>{post.img=e.target.result;posts.unshift(post);save();render()}
    r.readAsDataURL(f)
  }else{posts.unshift(post);save();render()}
  text.value="";img.value=""
}

function toggleLike(i){
  const l=posts[i].likes
  const idx=l.indexOf(current)
  idx>-1?l.splice(idx,1):l.push(current)
  save();render()
}

function addComment(i,input){
  if(!input.value)return
  posts[i].comments.push({u:current,t:input.value})
  save();render()
}

function addFriend(u){
  if(u===current)return
  if(!users[current].friends.includes(u)){
    users[current].friends.push(u)
    users[u].friends.push(current)
    save();render()
  }
}

function render(){
  feed.innerHTML=""
  posts.forEach((p,i)=>{
    const liked=p.likes.includes(current)
    const isFriend=users[current].friends.includes(p.u)
    feed.innerHTML+=`
    <div class="card post">
      <div class="userbar">
        <b>${p.u}</b>
        ${p.u!==current?`
          <div class="friend ${isFriend?"ok":"add"}"
            onclick="addFriend('${p.u}')">
            ${isFriend?"âœ“ å·²æ˜¯å¥½å‹":"â• åŠ å¥½å‹"}
          </div>`:""}
      </div>

      <div>${p.t}</div>
      ${p.img?`<img src="${p.img}">`:""}

      <div class="actions">
        <span onclick="toggleLike(${i})">${liked?"â¤ï¸":"ğŸ¤"} ${p.likes.length}</span>
        <span>ğŸ’¬ ${p.comments.length}</span>
      </div>

      ${p.comments.map(c=>`
        <div class="comment"><b>${c.u}</b> ${c.t}</div>
      `).join("")}

      <div class="comment-box">
        <input placeholder="ç•™è¨€â€¦" 
          onkeydown="if(event.key==='Enter')addComment(${i},this)">
      </div>
    </div>`
  })
}
</script>

</body>
</html>
