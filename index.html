<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>City Social</title>
<style>
:root{
  --bg:#0f1115;
  --card:#1a1d23;
  --border:#2a2e36;
  --accent:#1da1f2;
}
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI"}
body{
  margin:0;
  background:var(--bg);
  color:#e4e6eb;
}
header{
  position:sticky;top:0;z-index:10;
  background:#000c;
  backdrop-filter:blur(10px);
  display:flex;justify-content:space-between;
  padding:10px 24px;
  border-bottom:1px solid var(--border);
}
button{
  border:none;border-radius:20px;
  padding:6px 14px;
  background:var(--accent);
  color:#fff;
  cursor:pointer;
}
#logoutBtn{background:#e74c3c}
.hidden{display:none}

.container{
  max-width:1200px;margin:auto;
  display:grid;grid-template-columns:2.2fr 1fr;
  gap:24px;padding:24px;
}
.card{
  background:var(--card);
  border-radius:16px;
  padding:16px;
  box-shadow:0 10px 30px #0005;
  margin-bottom:20px;
}
input,textarea{
  width:100%;border-radius:10px;
  border:1px solid var(--border);
  background:#000;
  color:#fff;
  padding:10px;
}
.post-header{
  display:flex;align-items:center;gap:10px;
}
.avatar{
  width:42px;height:42px;border-radius:50%;
  background:#555;
}
.post img{
  width:100%;border-radius:12px;margin-top:10px;
}
.actions span{
  margin-right:16px;cursor:pointer;
}
.friend{
  display:flex;justify-content:space-between;
  align-items:center;margin:6px 0;
}
</style>
</head>
<body>

<header id="top" class="hidden">
  <b>ğŸŒƒ City Social</b>
  <div>
    <span id="userLabel"></span>
    <button id="logoutBtn" onclick="logout()">ç™»å‡º</button>
  </div>
</header>

<!-- ç™»å…¥ -->
<div id="login" class="container">
  <div class="card">
    <h2>ç™»å…¥ / è¨»å†Š</h2>
    <input id="acc" placeholder="å¸³è™Ÿ">
    <input id="pw" type="password" placeholder="å¯†ç¢¼">
    <button onclick="auth()">é–‹å§‹ä½¿ç”¨</button>
  </div>
</div>

<!-- App -->
<div id="app" class="hidden container">

  <!-- Feed -->
  <div>
    <div class="card">
      <textarea id="text" placeholder="åˆ†äº«ä½ çš„åŸå¸‚æ•…äº‹..."></textarea>
      <input type="file" id="img">
      <button onclick="post()">ç™¼ä½ˆ</button>
    </div>
    <div id="posts"></div>
  </div>

  <!-- Side -->
  <div>
    <div class="card">
      <h3>ğŸ‘¤ å€‹äºº</h3>
      <input id="nick">
      <button onclick="saveNick()">å„²å­˜</button>
      <div id="stat"></div>
    </div>

    <div class="card">
      <h3>ğŸ‘¥ å¥½å‹</h3>
      <div id="friends"></div>
    </div>
  </div>

</div>

<script>
const LS = localStorage;
let users = JSON.parse(LS.users || "{}");
let posts = JSON.parse(LS.posts || "[]");
let current = LS.current || "";

const loginDiv = document.getElementById("login");
const appDiv   = document.getElementById("app");
const topBar   = document.getElementById("top");

function auth(){
  if(!acc.value || !pw.value){
    alert("è«‹è¼¸å…¥å¸³è™Ÿèˆ‡å¯†ç¢¼");
    return;
  }
  if(!users[acc.value]){
    users[acc.value] = { pw: pw.value, nick: acc.value, friends: [] };
  }
  if(users[acc.value].pw !== pw.value){
    alert("å¯†ç¢¼éŒ¯èª¤");
    return;
  }
  current = acc.value;
  LS.current = current;
  save();
  showApp();
}

function showApp(){
  if(!current || !users[current]){
    logout();
    return;
  }
  loginDiv.classList.add("hidden");
  appDiv.classList.remove("hidden");
  topBar.classList.remove("hidden");

  userLabel.textContent = current;
  nick.value = users[current].nick;

  render();
}

function logout(){
  LS.removeItem("current");
  location.reload();
}

function saveNick(){
  users[current].nick = nick.value;
  save();
  render();
}

function post(){
  if(!current){
    alert("è«‹å…ˆç™»å…¥");
    return;
  }
  if(!text.value){
    alert("è«‹è¼¸å…¥å…§å®¹");
    return;
  }
  const f = img.files[0];
  if(f){
    const r = new FileReader();
    r.onload = () => addPost(r.result);
    r.readAsDataURL(f);
  }else{
    addPost("");
  }
}

function addPost(imgData){
  posts.unshift({
    id: Date.now(),
    user: current,
    text: text.value,
    img: imgData,
    likes: []
  });
  text.value = "";
  img.value = "";
  save();
  render();
}

function like(id){
  const p = posts.find(p=>p.id===id);
  if(!p) return;
  const i = p.likes.indexOf(current);
  i>=0 ? p.likes.splice(i,1) : p.likes.push(current);
  save();
  render();
}

function addFriend(u){
  if(users[current].friends.includes(u)) return;
  users[current].friends.push(u);
  users[u].friends.push(current);
  save();
  render();
}

function render(){
  postsDiv.innerHTML = "";
  posts.forEach(p=>{
    postsDiv.innerHTML += `
    <div class="card post">
      <div class="post-header">
        <div class="avatar"></div>
        <b>${users[p.user].nick}</b>
      </div>
      <div>${p.text}</div>
      ${p.img ? `<img src="${p.img}">` : ""}
      <div class="actions">
        <span onclick="like(${p.id})">â¤ï¸ ${p.likes.length}</span>
        ${p.user!==current ? `<span onclick="addFriend('${p.user}')">â• å¥½å‹</span>` : ""}
      </div>
    </div>`;
  });

  friends.innerHTML = "";
  users[current].friends.forEach(f=>{
    friends.innerHTML += `<div class="friend">${users[f].nick}</div>`;
  });

  stat.textContent = `å¥½å‹ ${users[current].friends.length}`;
}

function save(){
  LS.users = JSON.stringify(users);
  LS.posts = JSON.stringify(posts);
}

if(current && users[current]){
  showApp();
}else{
  topBar.classList.add("hidden");
  appDiv.classList.add("hidden");
  loginDiv.classList.remove("hidden");
}
</script>
</body>
</html>
