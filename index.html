<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>City Social</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
:root{
  --bg:#0b0f14;
  --card:#141922;
  --text:#fff;
  --sub:#9aa4b2;
  --blue:#1f6feb;
}
.light{
  --bg:#f2f3f5;
  --card:#fff;
  --text:#000;
  --sub:#666;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont;
  background:
    linear-gradient(to bottom,rgba(0,0,0,.6),rgba(0,0,0,.9)),
    url("https://images.unsplash.com/photo-1508057198894-247b23fe5ade?auto=format&fit=crop&w=1400&q=80")
    center/cover fixed;
  color:var(--text);
}
header{
  position:sticky;top:0;z-index:9;
  background:var(--card);
  padding:12px 16px;
  display:flex;justify-content:space-between;align-items:center;
}
main{max-width:520px;margin:auto;padding:12px;padding-bottom:90px}
.card{
  background:var(--card);
  border-radius:18px;
  padding:14px;
  margin-bottom:14px;
}
.hidden{display:none}
input,textarea{
  width:100%;background:transparent;color:var(--text);
  border:1px solid #444;border-radius:12px;
  padding:10px;margin:6px 0;
}
button{
  border:none;border-radius:20px;
  padding:6px 14px;background:var(--blue);
  color:#fff;
}
.nav{
  position:fixed;bottom:0;left:0;right:0;
  background:var(--card);
  display:flex;justify-content:space-around;
  padding:10px 0;font-size:22px;
}
.post img{width:100%;border-radius:12px;margin-top:6px}
.post-head{display:flex;align-items:center;gap:10px}
.avatar{
  width:38px;height:38px;border-radius:50%;
  object-fit:cover;
}
.actions{display:flex;gap:14px;font-size:18px;margin:6px 0}
.comment{font-size:14px;margin-top:4px}
.cover{width:100%;height:140px;object-fit:cover;border-radius:18px 18px 0 0}
.bigAvatar{
  width:96px;height:96px;border-radius:50%;
  margin-top:-48px;border:4px solid var(--card);
}
.small{font-size:13px;color:var(--sub)}
</style>
</head>

<body>
<header>
  <b>ğŸŒƒ City Social</b>
  <div>
    <span onclick="toggleMode()">ğŸŒ™</span>
    <span onclick="logout()">ç™»å‡º</span>
  </div>
</header>

<main>

<!-- ç™»å…¥ -->
<div class="card" id="auth">
  <input id="user" placeholder="å¸³è™Ÿ">
  <input id="pass" type="password" placeholder="å¯†ç¢¼">
  <button onclick="login()">ç™»å…¥ / è¨»å†Š</button>
</div>

<!-- å‹•æ…‹ç‰† -->
<div id="feed" class="hidden"></div>

<!-- å€‹äººé  -->
<div id="profile" class="hidden"></div>

<!-- èŠå¤© -->
<div id="messages" class="hidden"></div>

</main>

<div class="nav hidden" id="nav">
  <div onclick="showFeed()">ğŸ </div>
  <div onclick="showMessages()">ğŸ’¬</div>
  <div onclick="showProfile()">ğŸ‘¤</div>
</div>

<script>
let users=JSON.parse(localStorage.users||"{}");
let current=localStorage.current||null;
let viewUser=null;

function save(){localStorage.users=JSON.stringify(users)}

function login(){
  const u=user.value.trim(),p=pass.value;
  if(!u||!p)return alert("è«‹è¼¸å…¥å¸³å¯†");
  if(!users[u])users[u]={pass:p,avatar:"",cover:"",friends:[],blocks:[],requests:[],posts:[]};
  if(users[u].pass!==p)return alert("å¯†ç¢¼éŒ¯èª¤");
  current=u;localStorage.current=u;
  auth.classList.add("hidden");
  nav.classList.remove("hidden");
  showFeed();
}

function logout(){localStorage.clear();location.reload()}
function toggleMode(){document.body.classList.toggle("light")}

function showFeed(){
  hideAll();
  feed.classList.remove("hidden");
  renderFeed();
}
function showProfile(u=current){
  hideAll();
  viewUser=u;
  profile.classList.remove("hidden");
  renderProfile();
}
function showMessages(){
  hideAll();
  messages.classList.remove("hidden");
  messages.innerHTML="<div class='card'>èŠå¤©ç³»çµ±ï¼ˆç•¥ï¼Œå·²å¯å»¶ä¼¸ï¼‰</div>";
}
function hideAll(){
  feed.classList.add("hidden");
  profile.classList.add("hidden");
  messages.classList.add("hidden");
}

function renderFeed(){
  feed.innerHTML="";
  let all=[];
  users[current].friends.forEach(f=>{
    if(users[f]) users[f].posts.forEach(p=>all.push({...p,owner:f}));
  });
  users[current].posts.forEach(p=>all.push({...p,owner:current}));
  all.sort((a,b)=>b.time-a.time);

  all.forEach(p=>{
    feed.innerHTML+=`
    <div class="card post">
      <div class="post-head">
        <img class="avatar" src="${users[p.owner].avatar||'https://via.placeholder.com/50'}"
          onclick="showProfile('${p.owner}')">
        <b>${p.owner}</b>
      </div>
      <div>${p.text||""}</div>
      ${(p.imgs||[]).map(i=>`<img src="${i}">`).join("")}
      <div class="actions">
        <span onclick="like('${p.owner}','${p.id}')">â¤ï¸ ${p.likes.length}</span>
      </div>
      ${p.comments.map(c=>`<div class="comment"><b>${c.from}</b> ${c.text}</div>`).join("")}
    </div>`;
  });
}

function renderProfile(){
  const u=users[viewUser];
  profile.innerHTML=`
  <div class="card">
    <img class="cover" src="${u.cover||'https://via.placeholder.com/800x200'}">
    <img class="bigAvatar" src="${u.avatar||'https://via.placeholder.com/150'}">
    <h3>${viewUser}</h3>
    <div class="small">å¥½å‹ ${u.friends.length}</div>
    ${viewUser!==current?`
      <button onclick="removeFriend('${viewUser}')">å–æ¶ˆå¥½å‹</button>
      <button onclick="block('${viewUser}')">å°é–</button>`:""}
  </div>
  ${u.posts.map(p=>`
    <div class="card">
      <div>${p.text}</div>
      ${(p.imgs||[]).map(i=>`<img src="${i}">`).join("")}
    </div>`).join("")}
  `;
}

function like(owner,id){
  const p=users[owner].posts.find(x=>x.id===id);
  const i=p.likes.indexOf(current);
  if(i>-1)p.likes.splice(i,1);else p.likes.push(current);
  save();renderFeed();
}

function removeFriend(u){
  users[current].friends=users[current].friends.filter(f=>f!==u);
  users[u].friends=users[u].friends.filter(f=>f!==current);
  save();showProfile();
}
function block(u){
  users[current].blocks.push(u);
  removeFriend(u);
}

if(current&&users[current]){
  auth.classList.add("hidden");
  nav.classList.remove("hidden");
  showFeed();
}
</script>
</body>
</html>
