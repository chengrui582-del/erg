<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>City Social</title>

<style>
:root{
  --bg:#f2f2f2;
  --card:#fff;
  --text:#111;
  --sub:#666;
  --accent:#1877f2;
}
body.dark{
  --bg:#0f1115;
  --card:#1c1f26;
  --text:#eee;
  --sub:#aaa;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:var(--bg) url("assets/city.jpg") center/cover fixed;
  color:var(--text);
}
header{
  position:sticky;top:0;
  backdrop-filter:blur(10px);
  background:rgba(0,0,0,.3);
  color:#fff;
  padding:12px;
  display:flex;
  justify-content:space-between;
}
main{padding-bottom:80px}
.card{
  background:var(--card);
  margin:12px;
  border-radius:14px;
  padding:12px;
  box-shadow:0 6px 20px rgba(0,0,0,.15);
}
input,textarea,button{
  width:100%;
  border:none;
  padding:10px;
  border-radius:10px;
  margin-top:6px;
}
button{
  background:var(--accent);
  color:#fff;
  font-weight:600;
}
.nav{
  position:fixed;
  bottom:0;left:0;right:0;
  height:60px;
  background:var(--card);
  display:flex;
  border-top:1px solid #ccc;
}
.nav div{
  flex:1;
  text-align:center;
  padding-top:8px;
  font-size:12px;
}
.nav span{display:block;font-size:22px}
.avatar{
  width:42px;height:42px;
  border-radius:50%;
  object-fit:cover;
}
.post-img{
  width:100%;
  border-radius:12px;
  margin-top:8px;
}
.like{color:red}
.hidden{display:none}
.chat{
  max-height:300px;
  overflow:auto;
}
.msg{
  margin:6px 0;
  padding:8px;
  border-radius:12px;
  max-width:70%;
}
.me{background:#1877f2;color:#fff;margin-left:auto}
.you{background:#ddd;color:#000}
.badge{
  background:red;color:#fff;
  border-radius:50%;
  font-size:10px;
  padding:2px 6px;
}
</style>
</head>

<body>
<header>
  <b>ğŸ™ City Social</b>
  <button onclick="toggleDark()">ğŸŒ™</button>
</header>

<main id="app"></main>

<div class="nav">
  <div onclick="view('feed')"><span>ğŸ </span>é¦–é </div>
  <div onclick="view('chat')"><span>ğŸ’¬</span>èŠå¤© <span id="unread" class="badge hidden">!</span></div>
  <div onclick="view('profile')"><span>ğŸ‘¤</span>å€‹äºº</div>
</div>

<script>
/* ========= è³‡æ–™ ========= */
let me = localStorage.me || prompt("è¼¸å…¥ä½ çš„åå­—");
localStorage.me = me;

let users = JSON.parse(localStorage.users||"{}");
if(!users[me]){
  users[me]={friends:[],posts:[],msgs:{}};
}
localStorage.users = JSON.stringify(users);

/* ========= UI ========= */
const app = document.getElementById("app");

function view(v){
  if(v==="feed") feed();
  if(v==="chat") chatList();
  if(v==="profile") profile(me);
}

function toggleDark(){
  document.body.classList.toggle("dark");
}

/* ========= Feed ========= */
function feed(){
app.innerHTML=`
<div class="card">
  <textarea id="postText" placeholder="ä½ åœ¨æƒ³ä»€éº¼ï¼Ÿ"></textarea>
  <input type="file" id="postImg" multiple>
  <button onclick="addPost()">ç™¼ä½ˆ</button>
</div>
`;

users[me].posts.forEach((p,i)=>{
app.innerHTML+=`
<div class="card">
  <b>${me}</b>
  <p>${p.text}</p>
  ${p.imgs.map(img=>`<img class="post-img" src="${img}">`).join("")}
  <div>
    <button onclick="like(${i})">â¤ï¸ ${p.likes||0}</button>
    <button onclick="delPost(${i})">ğŸ—‘</button>
  </div>
</div>`;
});
}

function addPost(){
let text = postText.value;
let files = postImg.files;
let imgs=[];
if(files.length){
  [...files].forEach(f=>{
    let r=new FileReader();
    r.onload=e=>{
      imgs.push(e.target.result);
      if(imgs.length===files.length) save();
    }
    r.readAsDataURL(f);
  });
}else save();

function save(){
users[me].posts.unshift({text,imgs,likes:0});
localStorage.users=JSON.stringify(users);
feed();
}
}

function like(i){
users[me].posts[i].likes++;
localStorage.users=JSON.stringify(users);
feed();
}
function delPost(i){
users[me].posts.splice(i,1);
localStorage.users=JSON.stringify(users);
feed();
}

/* ========= Chat ========= */
function chatList(){
app.innerHTML="";
let u=users[me];
for(let f of u.friends){
app.innerHTML+=`
<div class="card" onclick="chat('${f}')">
  ğŸ‘¤ ${f}
</div>`;
}
}

function chat(who){
let msgs=users[me].msgs[who]||[];
app.innerHTML=`
<div class="card chat" id="chatBox"></div>
<input id="msgText" placeholder="è¼¸å…¥è¨Šæ¯">
<input type="file" id="imgSend">
<button onclick="send('${who}')">é€å‡º</button>
`;
let box=document.getElementById("chatBox");
msgs.forEach(m=>{
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>City Social</title>

<style>
:root{
  --bg:#f2f2f2;
  --card:#fff;
  --text:#111;
  --sub:#666;
  --accent:#1877f2;
}
body.dark{
  --bg:#0f1115;
  --card:#1c1f26;
  --text:#eee;
  --sub:#aaa;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:var(--bg) url("assets/city.jpg") center/cover fixed;
  color:var(--text);
}
header{
  position:sticky;top:0;
  backdrop-filter:blur(10px);
  background:rgba(0,0,0,.3);
  color:#fff;
  padding:12px;
  display:flex;
  justify-content:space-between;
}
main{padding-bottom:80px}
.card{
  background:var(--card);
  margin:12px;
  border-radius:14px;
  padding:12px;
  box-shadow:0 6px 20px rgba(0,0,0,.15);
}
input,textarea,button{
  width:100%;
  border:none;
  padding:10px;
  border-radius:10px;
  margin-top:6px;
}
button{
  background:var(--accent);
  color:#fff;
  font-weight:600;
}
.nav{
  position:fixed;
  bottom:0;left:0;right:0;
  height:60px;
  background:var(--card);
  display:flex;
  border-top:1px solid #ccc;
}
.nav div{
  flex:1;
  text-align:center;
  padding-top:8px;
  font-size:12px;
}
.nav span{display:block;font-size:22px}
.avatar{
  width:42px;height:42px;
  border-radius:50%;
  object-fit:cover;
}
.post-img{
  width:100%;
  border-radius:12px;
  margin-top:8px;
}
.like{color:red}
.hidden{display:none}
.chat{
  max-height:300px;
  overflow:auto;
}
.msg{
  margin:6px 0;
  padding:8px;
  border-radius:12px;
  max-width:70%;
}
.me{background:#1877f2;color:#fff;margin-left:auto}
.you{background:#ddd;color:#000}
.badge{
  background:red;color:#fff;
  border-radius:50%;
  font-size:10px;
  padding:2px 6px;
}
</style>
</head>

<body>
<header>
  <b>ğŸ™ City Social</b>
  <button onclick="toggleDark()">ğŸŒ™</button>
</header>

<main id="app"></main>

<div class="nav">
  <div onclick="view('feed')"><span>ğŸ </span>é¦–é </div>
  <div onclick="view('chat')"><span>ğŸ’¬</span>èŠå¤© <span id="unread" class="badge hidden">!</span></div>
  <div onclick="view('profile')"><span>ğŸ‘¤</span>å€‹äºº</div>
</div>

<script>
/* ========= è³‡æ–™ ========= */
let me = localStorage.me || prompt("è¼¸å…¥ä½ çš„åå­—");
localStorage.me = me;

let users = JSON.parse(localStorage.users||"{}");
if(!users[me]){
  users[me]={friends:[],posts:[],msgs:{}};
}
localStorage.users = JSON.stringify(users);

/* ========= UI ========= */
const app = document.getElementById("app");

function view(v){
  if(v==="feed") feed();
  if(v==="chat") chatList();
  if(v==="profile") profile(me);
}

function toggleDark(){
  document.body.classList.toggle("dark");
}

/* ========= Feed ========= */
function feed(){
app.innerHTML=`
<div class="card">
  <textarea id="postText" placeholder="ä½ åœ¨æƒ³ä»€éº¼ï¼Ÿ"></textarea>
  <input type="file" id="postImg" multiple>
  <button onclick="addPost()">ç™¼ä½ˆ</button>
</div>
`;

users[me].posts.forEach((p,i)=>{
app.innerHTML+=`
<div class="card">
  <b>${me}</b>
  <p>${p.text}</p>
  ${p.imgs.map(img=>`<img class="post-img" src="${img}">`).join("")}
  <div>
    <button onclick="like(${i})">â¤ï¸ ${p.likes||0}</button>
    <button onclick="delPost(${i})">ğŸ—‘</button>
  </div>
</div>`;
});
}

function addPost(){
let text = postText.value;
let files = postImg.files;
let imgs=[];
if(files.length){
  [...files].forEach(f=>{
    let r=new FileReader();
    r.onload=e=>{
      imgs.push(e.target.result);
      if(imgs.length===files.length) save();
    }
    r.readAsDataURL(f);
  });
}else save();

function save(){
users[me].posts.unshift({text,imgs,likes:0});
localStorage.users=JSON.stringify(users);
feed();
}
}

function like(i){
users[me].posts[i].likes++;
localStorage.users=JSON.stringify(users);
feed();
}
function delPost(i){
users[me].posts.splice(i,1);
localStorage.users=JSON.stringify(users);
feed();
}

/* ========= Chat ========= */
function chatList(){
app.innerHTML="";
let u=users[me];
for(let f of u.friends){
app.innerHTML+=`
<div class="card" onclick="chat('${f}')">
  ğŸ‘¤ ${f}
</div>`;
}
}

function chat(who){
let msgs=users[me].msgs[who]||[];
app.innerHTML=`
<div class="card chat" id="chatBox"></div>
<input id="msgText" placeholder="è¼¸å…¥è¨Šæ¯">
<input type="file" id="imgSend">
<button onclick="send('${who}')">é€å‡º</button>
`;
let box=document.getElementById("chatBox");
msgs.forEach(m=>{
box.innerHTML+=`
<div class="msg ${m.me?'me':'you'}">
  ${m.text||""}
  ${m.img?`<img class="post-img" src="${m.img}">`:""}
</div>`;
});
box.scrollTop=9999;
}

function send(who){
let text=msgText.value;
let file=imgSend.files[0];
if(!users[me].msgs[who]) users[me].msgs[who]=[];
if(!users[who].msgs[me]) users[who].msgs[me]=[];

if(file){
let r=new FileReader();
r.onload=e=>{
push(null,e.target.result);
}
r.readAsDataURL(file);
}else push(text,null);

function push(t,i){
users[me].msgs[who].push({me:true,text:t,img:i});
users[who].msgs[me].push({me:false,text:t,img:i});
localStorage.users=JSON.stringify(users);
chat(who);
}
}

/* ========= Profile ========= */
function profile(name){
let u=users[name];
app.innerHTML=`
<div class="card">
  <img src="assets/avatar.png" class="avatar">
  <h3>${name}</h3>
  <p>å¥½å‹ ${u.friends.length}</p>
  <input id="addName" placeholder="åŠ å¥½å‹">
  <button onclick="addFriend()">åŠ å¥½å‹</button>
</div>
`;
}

function addFriend(){
let f=addName.value;
if(!users[f]){alert("ä¸å­˜åœ¨");return;}
if(users[me].friends.includes(f))return;
users[me].friends.push(f);
users[f].friends.push(me);
localStorage.users=JSON.stringify(users);
alert("å·²æˆç‚ºå¥½å‹");
profile(me);
}

/* ========= å•Ÿå‹• ========= */
view("feed");
</script>
</body>
</html>
