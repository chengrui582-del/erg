<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>City Social</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box}
:root{
  --card:#111c;
  --text:#fff;
}
.light{
  --card:#fff;
  --text:#000;
}
body{
  margin:0;font-family:-apple-system,BlinkMacSystemFont;
  background:
    linear-gradient(rgba(0,0,0,.4),rgba(0,0,0,.7)),
    url("https://images.unsplash.com/photo-1499346030926-9a72daac6c63") center/cover fixed;
  color:var(--text);
}
header{
  position:sticky;top:0;z-index:9;
  background:var(--card);
  padding:12px 16px;
  display:flex;justify-content:space-between;
}
main{max-width:520px;margin:auto;padding:12px;padding-bottom:80px}
.card{
  background:var(--card);
  border-radius:18px;
  padding:14px;
  margin-bottom:16px;
}
.hidden{display:none}
button{
  border:none;border-radius:20px;
  padding:6px 12px;
  background:#1f6feb;color:#fff;
}
textarea,input{
  width:100%;background:transparent;
  border:1px solid #444;
  border-radius:10px;
  color:var(--text);
  padding:10px;
}
.carousel{
  display:flex;overflow-x:auto;
  scroll-snap-type:x mandatory;
  gap:8px;margin-top:8px;
}
.carousel img{
  flex:0 0 100%;
  border-radius:14px;
  scroll-snap-align:center;
}
.post-tools{
  display:flex;gap:10px;
  font-size:14px;margin-top:6px;
}
.post-tools span{cursor:pointer;opacity:.7}
.post-tools span:hover{opacity:1}
.nav{
  position:fixed;bottom:0;left:0;right:0;
  display:flex;justify-content:space-around;
  background:var(--card);padding:10px 0;
}
</style>
</head>

<body>

<header>
  <b>ğŸŒƒ City Social</b>
  <span onclick="toggleMode()">ğŸŒ™</span>
</header>

<main>

<!-- ç™»å…¥ -->
<div class="card" id="auth">
  <h3>ç™»å…¥ / è¨»å†Š</h3>
  <input id="user" placeholder="å¸³è™Ÿ">
  <input id="pass" type="password" placeholder="å¯†ç¢¼">
  <button onclick="login()">é–‹å§‹</button>
</div>

<!-- HOME -->
<div id="home" class="hidden">
  <div class="card">
    <textarea id="text" placeholder="åˆ†äº«åŸå¸‚ç”Ÿæ´»â€¦"></textarea>
    <input type="file" id="img" multiple>
    <button onclick="publish()" id="postBtn">ç™¼å¸ƒ</button>
  </div>
  <div id="feed"></div>
</div>

</main>

<div class="nav hidden" id="nav">
  <div onclick="show('home')">ğŸ </div>
</div>

<script>
let current=null
let editingIndex=null
const users=JSON.parse(localStorage.users||"{}")
const posts=JSON.parse(localStorage.posts||"[]")
let mode=localStorage.mode||"dark"

if(mode==="light")document.body.classList.add("light")

function save(){
  localStorage.users=JSON.stringify(users)
  localStorage.posts=JSON.stringify(posts)
  localStorage.mode=mode
}

function toggleMode(){
  document.body.classList.toggle("light")
  mode=document.body.classList.contains("light")?"light":"dark"
  save()
}

function login(){
  if(!users[user.value])
    users[user.value]={pass:pass.value}
  if(users[user.value].pass!==pass.value)return alert("å¯†ç¢¼éŒ¯")
  current=user.value
  auth.classList.add("hidden")
  nav.classList.remove("hidden")
  show("home")
  render()
}

function show(v){
  home.classList.add("hidden")
  document.getElementById(v).classList.remove("hidden")
}

function publish(){
  if(!text.value)return
  const files=[...img.files]
  const post={u:current,t:text.value,imgs:[]}

  const finish=()=>{
    if(editingIndex===null){
      posts.unshift(post)
    }else{
      posts[editingIndex]=post
      editingIndex=null
      postBtn.textContent="ç™¼å¸ƒ"
    }
    save();render()
  }

  if(files.length){
    let loaded=0
    files.forEach(f=>{
      const r=new FileReader()
      r.onload=e=>{
        post.imgs.push(e.target.result)
        if(++loaded===files.length)finish()
      }
      r.readAsDataURL(f)
    })
  }else finish()

  text.value="";img.value=""
}

function editPost(i){
  const p=posts[i]
  text.value=p.t
  editingIndex=i
  postBtn.textContent="å„²å­˜ä¿®æ”¹"
  window.scrollTo({top:0,behavior:"smooth"})
}

function deletePost(i){
  if(confirm("ç¢ºå®šåˆªé™¤é€™ç¯‡è²¼æ–‡ï¼Ÿ")){
    posts.splice(i,1)
    save();render()
  }
}

function render(){
  feed.innerHTML=""
  posts.forEach((p,i)=>{
    feed.innerHTML+=`
    <div class="card">
      <b>${p.u}</b>
      <div>${p.t}</div>

      ${p.imgs?.length?`
        <div class="carousel">
          ${p.imgs.map(img=>`<img src="${img}">`).join("")}
        </div>`:""}

      ${p.u===current?`
      <div class="post-tools">
        <span onclick="editPost(${i})">âœï¸ ç·¨è¼¯</span>
        <span onclick="deletePost(${i})">ğŸ—‘ åˆªé™¤</span>
      </div>`:""}
    </div>`
  })
}
</script>

</body>
</html>

